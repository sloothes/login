<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0 initial-scale=1.0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" contents="Login to sloothes.com">

    <title>login (scc v1.1)</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootbox-dialoges.css">
    <link rel="stylesheet" href="/css/alerts.css">
    <link rel="stylesheet" href="/css/meter.css">

    <script src="/socketcluster.js"></script>
    <script src="/sc-codec-min-bin.js"></script>

    <script src="/js/loadjs.min.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery-ui.js"></script>
    <script src="/js/bootbox.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/alerts.js"></script>
    <script src="/js/validator.min.js"></script>
    <script src="/js/DeviceDetector.js"></script>

    <script>

        debugMode = true;

        console.log({
            "debug": debugMode,
            "scc-version": socketCluster.version,
            "scc-clients": socketCluster.clients,
        });

    </script>

</head>

<body>

<style>

    #login-form { 
        width:350px; 
    }

    #login-logo { 
        width:100%; 
        height:auto; 
    }

    .middle > * {
        position:absolute;
        height:fit-content;
        width:fit-content;
        top:0; bottom:0;
        left:0; right:0;
        margin:auto;
    }

</style>

<section class="middle">

    <div class="well" id="login-form">
        <h2 style="margin-top:0;">Login</h2>
        <h6>Login to Your Account</h6>

        <img id="login-logo" src="//i.imgur.com/kCxGqHm.png">

    <!--
        <div class="form-group">
            <div class="login-label">Username or Email</div>
            <input type="email" class="form-control" id="email" name="email" required title="Type your email">
        </div>
    -->

        <div class="form-group">
            <div class="login-label">Username or Email</div>
            <input type="text" class="form-control" id="username" name="username" required title="Type your username">
        </div>
        <div class="form-group">
            <div class="login-label">Password</div>
            <input type="password" class="form-control" id="password" name="password" required title="Type your password">
        </div>

        <div class="form-group">
            <a class="btn btn-default pull-right" id="signup-btn" name="submit">Login</a>
            <a class="btn btn-default pull-right" id="cancel-btn" name="cancel">Cancel</a>
        </div>

        <div class="btm-links">
            <div id="signup-account"><a href="/signup">Don't have an Account?</a></div>
        </div>

    </div>

</section>

<script>

    socket = socketCluster.create({
        //  port:443,
        hostname: "anywhere3d.com",
        codecEngine: scCodecMinBin,
    });

    socket.on("connect", function (status) {
        debugMode && console.log("status:", status);
        if (status.isAuthenticated) {
            var authToken = socket.getAuthToken();

        //  if ( !$("#username").val() )
        //      $("#username").val(authToken.email);

        //  $("#email").val(authToken.email);
        //  if ( authToken.email ) {
        //      $("#username").val(authToken.email);
        //  } else if ( authToken.username ) {
        //      $("#username").val(authToken.username);
        //  }
        //  $("#password").val(authToken.password);

            debugMode && console.log( "authToken:", authToken );
        }
    });

    socket.on("authenticate", function( signedAuthToken ){
        debugMode && console.log("signedAuthToken:", signedAuthToken );
    });

    socket.on("deauthenticate", function( signedAuthToken ){
        debugMode && console.log("signedAuthToken:", signedAuthToken );
    });

    socket.on("authStateChange", function( state ){
        debugMode && console.log("state:", state);
    });

    socket.on("kickOut", function(message, channelName){
        debugMode && console.log("kickOut message:", message);
        debugMode && console.log("kickOut channel:", channelName);
    });

    socket.on("raw", function(){});
    socket.on("close", function(){});
    socket.on("disconnect", function(){});
    socket.on("connectAbort", function(){});

    socket.on("error", function (err) {
        console.error( "scc-error:", err );
        if (err) bootboxErrorAlert( err.message, function(){});
    });

    socket.on("message", function(data){
    //  debugMode && console.log( "scc-message:", data );
    });

</script>

<script>

    $(function(){
        debugMode && console.log("username:", $("#username").val() );
    });

    $("#login-btn").on("click", function(){

        var credentials = {};
    //  credentials.email    = $("#email").val();
        credentials.username = $("#username").val();
        credentials.password = $("#password").val();

        socket.emit("login", credentials, function(err, data){
            if (err) {

                console.error( "login error:", err );

                bootbox.dialog({
                    size: "small",
                    className: "middle",
                    closeButton: true,
                    title: `<div class="alert-icon icon-warning">` 
                    + `</div><h2 style="margin:auto;">Error!</h2>`,
                    message: `<div>Sorry! An error occurred.</div>`
                    + `<div>${err}</div>`,
                    buttons: {
                        cancel: {
                            label: "Close",
                            className: "btn-default",
                        },
                    },
                });

            } else {

                debugMode && console.log("login success:", data);

                if (data.success) bootbox.dialog({
                    size: "small",
                    className: "middle",
                    closeButton: false,
                    title: `<div class="alert-icon icon-success">`
                    + `</div><h2 style="margin:auto;">Success</h2>`,
                    message: `<div>${data.success}</div>`,
                    buttons: { 
                        success: {
                            label: "Close",
                            className: "btn-success",
                            callback: function(){ 
                                bootbox.hideAll(); 
                            }
                        },
                    }
                });

            }
        });

    });

    $("#cancel-btn").on("click", function(){

        var msg = "Login canceled by the user."

        bootbox.dialog({
            size: "small",
            className: "middle",
            closeButton: true,
            title: `<div class="alert-icon icon-warning">` 
            + `</div><h2 style="margin:auto;">Canceled</h2>`,
            message: `<div>${msg}</div>`,
            buttons: {
                cancel: {
                    label: "Close",
                    className: "btn-default",
                },
            }
        });

    });

</script>

</body>
</html>
